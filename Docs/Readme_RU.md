# Pools
Pools - это ассет с парочкой классов, которые позволят вам создавать и работать с пулами легко и просто.

### Подключение
Для работы с пулом подключите пространство имен `Redcode.Pools`.
```C#
using Redcode.Pools
```

# Pool
### Создание пула из кода
Для создания пула используйте метод `Pool.Create<T>(T component, int count)`. Первым параметром укажите любой компонент на игровом объекте в сцене или префабе, 
во втором - максимальное количество клонов, которые данный пул должен создать.
```C#
var pool = Pool.Create(prefab, 10);
```

В параметре вы можете указать 0, чтобы пул не имел ограничения на количество клонов. Также, вы можете указать третьим параметром `container`,
в который будут добавляться все клоны.
```C#
var container = someObject.transform;
var pool = Pool.Create(prefab, 0, container);
```

### Запрос объекта
Используйте метод `Get` чтобы получить свободный объект из пула. Вызов этой функции создаст клона, если нет свободного и если не достигнуто ограничение на максимальное количество.
В противном случае, будет возвращено значение `null`.
```C#
Enemy enemy = pool.Get();

if (enemy != null) { ... }
```

Неиспользуемые объекты пула по умолчанию неактивны. В момент запроса объекта из пула, он становится активным.

### Возврат объекта
Когда запрошенный объект становится больше не нужен, его надо вернуть пулу. Для этого используйте метод `Take`.
```C#
pool.Take(enemy);
```

При возврате объекта в пул, он становится неактивным.

> Если объекта, который возвращают не существует в пуле (то есть, он не был создан самим пулом), то он будет добавлен в него и станет дочерним объектом контейнера (о них позже) пула.

### Ожидание свободного объекта
Если вы хотите подождать свободный объект в пуле, используйте WaitForFreeObject.
```C#
yield return pool.WaitForFreeObject();
var enemy = pool.Get();
```

Когда в пуле появится свободный объект, ваша корутина продолжит выполнение.

### Мгновенное создание объектов пула
Если вы хотите чтобы пул заранее создал клонов, используйте метод `NonLazy`.
```C#
var pool = Pool.Create(prefab, 10).NonLazy();
```

> Чтобы этот метод имел эффект, необходимо чтобы пул имел ограничение на количество создаваемых клонов.

### Установка новых ограничений по количеству клонов
Вы можете использовать свойство Count чтобы получить значение максимального количества клонов, и метод SetCount чтобы установить его. При установке нового количества,
если оно меньше предыдущего, то те клоны что расположены в конце списка будут удалены, даже если их не вернули пулу. 
Если же нужно при такой ситуации не удалять клонов, а только из внутреннего списка, то укажите false вторым параметром в методе.  
```C#
pool.SetCount(5, false); // Клоны не будут удалены.
```

### Установка нового контенера
Вы можете указать новый контейнер для клонов, для этого используйте метод `SetContainer`. Клоны будут перемещены в новый контейнер где бы они не находились. 
Если вам нужно чтобы клоны в новом контейнере располагались локально, а не сохраняли свою позицию в глобальном пространстве, укажите вторым параметром значение `false`.
```C#
pool.SetContainer(newContainer, false);
```

### Очистка пула
Используйте метод Clear чтобы очистить пул объектов. Также можно указать нужно ли удалять клонов из сцены или нет.
```C#
pool.Clear();
```

# IPoolObject
Иногда бывает необходимо чтобы объекты возвращаемые из пула сначала были специальным образом обработаны, например враг который был убит и возвращен в пул, 
при следующем запросе должен выглядеть живым, а не мертвым. Для этого используйте интерфейс IPoolObject, реализуйте его в нужном скрипте как должен быть обработан
клон перед тем как будет возвращен из пула.
```C#
public class Enemy : MonoBehaviour, IPoolObject
{
    public void OnGettingFromPool()
    {
        print("Resetted");
    }
}
```

# Менеджер пулов
Используйте менджер пулов в сцене, чтобы выполнить всю нужную настройку над пулами, а затем использовать их в игровой логике. Добавьте скрипт PoolManager на пустой 
игровой объект и выполните его настройку. 

![image](https://user-images.githubusercontent.com/5365111/185308746-d82cec87-34de-4644-a788-8377698d3339.png)

Каждый пул у менеджера имеет свое имя, оно может использоваться для поиска нужного пула в менеджере. Добавьте ссылку на менеджер в любой нужный вам скрипт и используйте его чтобы получать пулы или сразу объекты из пулов, как в примерах ниже.
```C#
var pool = manager.GetPool<Enemy>(1); // Взять пул по индексу 1.
var clone = manager.GetFromPool<Enemy>(1) // Запросить объект из пула с индексом 1.
manager.TakeToPool(1, clone); // Вернуть клона в пул с индексом 1.

// ----------------------------------------------------------------------------------

var pool = manager.GetPool<Enemy>(); // Взять первый подходящий пул Pool<Enemy> из списка.
var clone = manager.GetFromPool<Enemy>(); // Запросить клона из первого подходящего пула Pool<Enemy>().
manager.TakeToPool(clone); // Вернуть клона в первый подходящий пул с индексом 1.

// ----------------------------------------------------------------------------------
var pool = manager.GetPool<Enemy>("Enemy"); // Взять пул Pool<Enemy> по имени.
var clone = manager.GetFromPool<Enemy>("Enemy"); // Запросить клона из пула Pool<Enemy>() по имени.
manager.TakeToPool("Enemy", clone); // Вернуть клона в первый подходящий пул с именем.
```

Удачи!
